<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MathClass Calculator</title>
<link href="https://fonts.googleapis.com/css2?family=Schoolbell&family=Permanent+Marker&family=Special+Elite&family=Caveat:wght@400;600;700&display=swap" rel="stylesheet">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

:root {
  --chalk-white: #f0ece0;
  --board-dark: #1a3a2a;
  --board-mid: #1f4a32;
  --board-light: #254d35;
  --chalk-blue: #8ecae6;
  --chalk-yellow: #ffd166;
  --chalk-pink: #ff9baf;
  --chalk-green: #90e0a0;
  --chalk-red: #ff6b6b;
  --paper: #fef9ef;
  --paper-line: #c8d8e8;
  --ink-blue: #1a3a6b;
}

body {
  font-family: 'Caveat', cursive;
  background: #2c1810;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 0;
  overflow-x: hidden;
}

body::after {
  content: '';
  position: fixed;
  bottom: 0; left: 0; right: 0;
  height: 60px;
  background: repeating-linear-gradient(90deg,#5c3d1e 0px,#7a5230 40px,#6b4a25 80px,#5c3d1e 120px);
  z-index: 0;
  box-shadow: inset 0 4px 12px rgba(0,0,0,0.5);
}

.classroom-header {
  width: 100%;
  background: linear-gradient(180deg,#1a0e08 0%,#2c1810 100%);
  padding: 14px 0 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  border-bottom: 8px solid #5c3d1e;
  box-shadow: 0 6px 20px rgba(0,0,0,0.6);
}

.school-banner {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 18px;
  margin-bottom: 12px;
  padding: 0 24px;
}

.school-crest {
  width: 54px;
  height: 54px;
  border-radius: 50%;
  background: radial-gradient(circle,#d4a017,#8b6b00);
  border: 3px solid #c8900a;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.4);
  flex-shrink: 0;
}

.school-name { font-family: 'Special Elite', cursive; font-size: clamp(18px,4vw,30px); color: var(--chalk-yellow); letter-spacing: 2px; text-shadow: 0 2px 8px rgba(0,0,0,0.5); }
.school-tagline { font-family: 'Caveat', cursive; font-size: 13px; color: rgba(240,236,224,0.5); letter-spacing: 1px; text-align: center; }

.chalk-tray {
  width: calc(100% - 32px);
  max-width: 944px;
  height: 18px;
  background: linear-gradient(180deg,#8b6340 0%,#6b4a25 100%);
  border-radius: 0 0 4px 4px;
  display: flex;
  align-items: center;
  padding: 0 16px;
  gap: 8px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.4);
  margin: 0 auto;
}
.chalk-stick { height: 8px; border-radius: 4px; flex-shrink: 0; }

.chalkboard-wrap {
  width: 100%;
  max-width: 960px;
  padding: 0 16px 80px;
  position: relative;
  z-index: 1;
}

.board-frame {
  background: linear-gradient(145deg,#8b6340,#5c3d1e 30%,#7a5230 70%,#6b4a25);
  padding: 16px;
  border-radius: 4px 4px 0 0;
  box-shadow: inset 0 0 20px rgba(0,0,0,0.5), 0 -4px 0 #4a2e10, 4px 0 0 #4a2e10, -4px 0 0 #4a2e10;
}

.board-surface {
  background: radial-gradient(ellipse at 30% 20%,rgba(40,80,55,0.4) 0%,transparent 50%),radial-gradient(ellipse at 70% 80%,rgba(20,60,35,0.3) 0%,transparent 50%),linear-gradient(135deg,#1f4a32 0%,#1a3a2a 40%,#1f4a32 70%,#1a3a2a 100%);
  border-radius: 2px;
  padding: 24px 20px 20px;
  position: relative;
  min-height: 500px;
  overflow: hidden;
}

.board-surface::before {
  content:'';position:absolute;inset:0;
  background:radial-gradient(ellipse 200px 80px at 15% 60%,rgba(240,236,224,0.03) 0%,transparent 100%),radial-gradient(ellipse 160px 60px at 75% 30%,rgba(240,236,224,0.02) 0%,transparent 100%);
  pointer-events:none;
}

.chalk-deco {
  position:absolute;font-family:'Caveat',cursive;
  color:rgba(240,236,224,0.1);pointer-events:none;line-height:1.4;
}

.board-title-area { text-align:center; margin-bottom:20px; }
.board-title-area::after { content:''; display:block; height:2px; background:repeating-linear-gradient(90deg,transparent 0px,transparent 4px,rgba(240,236,224,0.2) 4px,rgba(240,236,224,0.2) 8px); margin-top:10px; }
.board-subject { font-family:'Permanent Marker',cursive; font-size:clamp(22px,5vw,36px); color:var(--chalk-white); text-shadow:1px 1px 0 rgba(255,255,255,0.08),0 0 20px rgba(240,236,224,0.12); }
.board-date-row { display:flex; justify-content:space-between; margin-top:4px; }
.board-label { font-family:'Caveat',cursive; font-size:14px; color:rgba(240,236,224,0.45); }

.board-content { display:grid; grid-template-columns:1fr 278px; gap:20px; align-items:start; }
@media (max-width:700px) { .board-content { grid-template-columns:1fr; } .right-panel { display:none; } }

/* DISPLAY */
.calc-section-label { font-family:'Caveat',cursive; font-size:15px; color:var(--chalk-yellow); margin-bottom:8px; display:flex; align-items:center; gap:6px; }
.calc-section-label::before { content:'‚ñ∂'; font-size:9px; opacity:0.7; }

.calc-display {
  background:var(--paper);border-radius:4px;margin-bottom:12px;overflow:hidden;
  box-shadow:2px 3px 0 rgba(0,0,0,0.35),0 0 0 2px rgba(240,236,224,0.12);position:relative;
}
.calc-display::before {
  content:'';position:absolute;inset:0;
  background-image:linear-gradient(var(--paper-line) 1px,transparent 1px),linear-gradient(90deg,var(--paper-line) 1px,transparent 1px);
  background-size:20px 20px;opacity:0.35;pointer-events:none;
}
.calc-display::after { content:'';position:absolute;top:0;bottom:0;left:36px;width:1.5px;background:rgba(220,80,80,0.28); }

.display-inner { padding:12px 16px 10px 44px; position:relative; z-index:1; min-height:90px; display:flex; flex-direction:column; justify-content:flex-end; align-items:flex-end; gap:2px; }
.display-mode { position:absolute; top:8px; left:44px; font-family:'Caveat',cursive; font-size:11px; color:rgba(26,58,107,0.45); text-transform:uppercase; letter-spacing:1px; }
.display-expr { font-family:'Caveat',cursive; font-size:15px; color:rgba(26,58,107,0.45); min-height:20px; text-align:right; word-break:break-all; }
.display-main { font-family:'Caveat',cursive; font-size:46px; font-weight:700; color:var(--ink-blue); text-align:right; line-height:1; word-break:break-all; transition:transform 0.08s; }
.display-main.pop { transform:scale(1.05); }
.line-nums { position:absolute; left:0; top:0; bottom:0; width:34px; display:flex; flex-direction:column; justify-content:flex-end; padding-bottom:10px; z-index:1; }
.line-num { font-family:'Caveat',cursive; font-size:10px; color:rgba(26,58,107,0.28); text-align:center; line-height:20px; }

/* KEYPAD */
.keypad-wrap { background:rgba(0,0,0,0.18); border-radius:8px; padding:12px; }
.keypad-section-label { font-family:'Caveat',cursive; font-size:11px; color:rgba(240,236,224,0.35); text-align:center; margin-bottom:6px; letter-spacing:1px; text-transform:uppercase; }
.keypad-grid { display:grid; grid-template-columns:repeat(4,1fr); gap:7px; margin-bottom:6px; }

.key { height:52px; border-radius:6px; border:none; cursor:pointer; font-family:'Caveat',cursive; font-size:17px; font-weight:700; display:flex; align-items:center; justify-content:center; transition:transform 0.07s,filter 0.07s; -webkit-tap-highlight-color:transparent; user-select:none; }
.key:active { transform:scale(0.91) translateY(1px); filter:brightness(0.82); }

.key-fn { background:rgba(240,236,224,0.07); color:var(--chalk-blue); border:1.5px solid rgba(142,202,230,0.22); font-size:14px; }
.key-fn:hover { background:rgba(142,202,230,0.11); }
.key-num { background:rgba(240,236,224,0.11); color:var(--chalk-white); border:1.5px solid rgba(240,236,224,0.18); }
.key-num:hover { background:rgba(240,236,224,0.17); }
.key-op { background:rgba(255,209,102,0.14); color:var(--chalk-yellow); border:1.5px solid rgba(255,209,102,0.28); font-size:20px; }
.key-op:hover { background:rgba(255,209,102,0.2); }
.key-eq { background:rgba(144,224,160,0.18); color:var(--chalk-green); border:1.5px solid rgba(144,224,160,0.32); font-size:22px; }
.key-eq:hover { background:rgba(144,224,160,0.26); }
.key-clear { background:rgba(255,107,107,0.14); color:var(--chalk-red); border:1.5px solid rgba(255,107,107,0.28); font-size:14px; }
.key-back { background:rgba(255,155,175,0.11); color:var(--chalk-pink); border:1.5px solid rgba(255,155,175,0.22); font-size:16px; }
.key-zero { grid-column:span 2; }

.calc-bottom { margin-top:10px; display:flex; align-items:center; justify-content:space-between; gap:8px; flex-wrap:wrap; }
.quick-formula-row { display:flex; gap:5px; flex-wrap:wrap; }
.qf-chip { background:rgba(240,236,224,0.06); border:1px solid rgba(240,236,224,0.13); border-radius:20px; padding:3px 10px; font-family:'Caveat',cursive; font-size:13px; color:rgba(240,236,224,0.65); cursor:pointer; transition:0.15s; white-space:nowrap; }
.qf-chip:hover { background:rgba(255,209,102,0.14); border-color:rgba(255,209,102,0.28); color:var(--chalk-yellow); }

.code-mode-btn { background:rgba(0,0,0,0.28); color:rgba(240,236,224,0.38); border:1px solid rgba(240,236,224,0.09); border-radius:6px; padding:5px 12px; font-family:'Caveat',cursive; font-size:12px; cursor:pointer; transition:0.2s; letter-spacing:0.5px; white-space:nowrap; flex-shrink:0; }
.code-mode-btn:hover { color:var(--chalk-blue); border-color:rgba(142,202,230,0.28); background:rgba(142,202,230,0.07); }

/* RIGHT PANEL */
.right-panel { display:flex; flex-direction:column; gap:14px; }
.sticky-note { border-radius:2px; padding:12px 14px; position:relative; box-shadow:2px 3px 8px rgba(0,0,0,0.3); }
.sticky-note::before { content:''; position:absolute; top:-6px; left:50%; transform:translateX(-50%); width:30px; height:12px; background:rgba(255,255,255,0.18); border-radius:2px; box-shadow:0 1px 3px rgba(0,0,0,0.2); }
.sticky-yellow { background:#fef08a; } .sticky-blue { background:#bfdbfe; } .sticky-pink { background:#fbcfe8; }
.sticky-note h4 { font-family:'Permanent Marker',cursive; font-size:13px; color:#1a1410; margin-bottom:8px; border-bottom:1.5px solid rgba(0,0,0,0.1); padding-bottom:4px; }
.sticky-note .fact-body, .sticky-note p { font-family:'Caveat',cursive; font-size:14px; color:#2c2010; line-height:1.5; font-weight:600; }
.sticky-note p strong { color:#7a2000; }

.formula-rows { display:flex; flex-direction:column; gap:4px; }
.formula-row { display:flex; justify-content:space-between; border-bottom:1px dashed rgba(0,0,0,0.1); padding:2px 0; gap:8px; }
.formula-row:last-child { border-bottom:none; }
.formula-eq { font-family:'Caveat',cursive; font-size:15px; font-weight:700; color:#1a3a6b; white-space:nowrap; }
.formula-desc { font-family:'Caveat',cursive; font-size:13px; color:#4a4030; text-align:right; }

.history-rows { display:flex; flex-direction:column; gap:3px; max-height:120px; overflow-y:auto; }
.history-rows::-webkit-scrollbar { width:3px; }
.history-rows::-webkit-scrollbar-thumb { background:rgba(0,0,0,0.15); border-radius:2px; }
.history-entry { display:flex; justify-content:space-between; font-family:'Caveat',cursive; font-size:13px; color:#3a3020; padding:2px 4px; border-radius:3px; cursor:pointer; transition:0.12s; }
.history-entry:hover { background:rgba(0,0,0,0.08); }
.history-res { font-weight:700; color:#7a2000; }
.history-empty { font-size:12px; color:rgba(58,48,32,0.5); text-align:center; padding:6px; }

/* MODAL */
.modal-overlay { position:fixed; inset:0; background:rgba(10,25,15,0.88); backdrop-filter:blur(4px); display:none; align-items:center; justify-content:center; z-index:1000; }
.modal-overlay.active { display:flex; }
.modal-card { background:var(--paper); border-radius:6px; width:90%; max-width:340px; overflow:hidden; box-shadow:4px 6px 0 rgba(0,0,0,0.4),0 20px 60px rgba(0,0,0,0.5); animation:modalPop 0.28s cubic-bezier(0.34,1.56,0.64,1); position:relative; }
@keyframes modalPop { from{transform:scale(0.8) rotate(-2deg);opacity:0;} to{transform:scale(1) rotate(0deg);opacity:1;} }
.modal-card::before { content:''; position:absolute; inset:0; background-image:linear-gradient(var(--paper-line) 1px,transparent 1px); background-size:100% 28px; opacity:0.38; pointer-events:none; }
.modal-header { background:var(--board-dark); padding:14px 18px; }
.modal-header h2 { font-family:'Permanent Marker',cursive; font-size:20px; color:var(--chalk-white); text-shadow:0 0 15px rgba(240,236,224,0.18); }
.modal-header p { font-family:'Caveat',cursive; font-size:13px; color:rgba(240,236,224,0.5); margin-top:2px; }
.modal-body { padding:20px 18px; position:relative; z-index:1; }
.pin-label { font-family:'Caveat',cursive; font-size:15px; color:var(--ink-blue); margin-bottom:10px; font-weight:600; }
.pin-row { display:flex; gap:10px; margin-bottom:16px; justify-content:center; }
.pin-input { width:54px; height:58px; border:2px solid rgba(26,58,107,0.2); border-radius:4px; background:rgba(200,216,232,0.1); font-family:'Permanent Marker',cursive; font-size:26px; text-align:center; color:var(--ink-blue); outline:none; transition:0.15s; }
.pin-input:focus { border-color:var(--ink-blue); background:white; box-shadow:0 0 0 3px rgba(26,58,107,0.1); }
.pin-input.error { border-color:#cc3333; background:rgba(255,0,0,0.05); animation:shake 0.35s ease; }
@keyframes shake { 0%,100%{transform:translateX(0);} 20%{transform:translateX(-6px);} 60%{transform:translateX(6px);} }
.modal-unlock-btn { width:100%; padding:11px; background:var(--board-dark); color:var(--chalk-white); border:none; border-radius:4px; font-family:'Permanent Marker',cursive; font-size:16px; cursor:pointer; transition:0.15s; margin-bottom:8px; }
.modal-unlock-btn:hover { background:var(--board-light); }
.modal-cancel-btn { width:100%; background:none; border:none; font-family:'Caveat',cursive; font-size:14px; color:rgba(26,58,107,0.5); cursor:pointer; font-weight:600; padding:4px; }
.modal-cancel-btn:hover { color:var(--ink-blue); }

/* CODE MODE */
#codeModeContainer { display:none; position:fixed; inset:0; z-index:2000; background:#000; }
#codeModeContainer.active { display:block; }
#codeFrame { width:100%; height:100%; border:none; }

</style>
</head>
<body>

<div class="classroom-header">
  <div class="school-banner">
    <div class="school-crest">üìê</div>
    <div>
      <div class="school-name">MATHCLASS ONLINE</div>
      <div class="school-tagline">Where numbers make sense</div>
    </div>
    <div class="school-crest">üî¢</div>
  </div>
</div>

<div class="chalk-tray">
  <div class="chalk-stick" style="width:48px;background:#f0ece0;"></div>
  <div class="chalk-stick" style="width:36px;background:#8ecae6;"></div>
  <div class="chalk-stick" style="width:42px;background:#ffd166;"></div>
  <div class="chalk-stick" style="width:30px;background:#ff9baf;"></div>
  <div class="chalk-stick" style="width:38px;background:#90e0a0;"></div>
  <div class="chalk-stick" style="width:28px;background:#f0ece0;"></div>
</div>

<div class="chalkboard-wrap">
  <div class="board-frame">
    <div class="board-surface">

      <div class="chalk-deco" style="top:8px;right:10px;font-size:30px;transform:rotate(8deg);">‚àë ‚à´ œÄ Œî</div>
      <div class="chalk-deco" style="bottom:55px;right:14px;font-size:19px;transform:rotate(-4deg);line-height:1.9;">sin¬≤Œ∏+cos¬≤Œ∏=1<br>e^(iœÄ)+1=0<br>PV = nRT</div>
      <div class="chalk-deco" style="bottom:55px;left:6px;font-size:17px;transform:rotate(3deg);line-height:1.9;">a¬≤+b¬≤=c¬≤<br>V = œÄr¬≤h<br>d = rt</div>

      <div class="board-title-area">
        <div class="board-subject">Scientific Calculator</div>
        <div class="board-date-row">
          <span class="board-label">Period 3 ¬∑ Mathematics</span>
          <span class="board-label" id="boardDate"></span>
        </div>
      </div>

      <div class="board-content">

        <!-- CALCULATOR -->
        <div class="calc-section">
          <div class="calc-section-label">Your Calculator</div>

          <div class="calc-display">
            <div class="line-nums">
              <div class="line-num">3</div>
              <div class="line-num">2</div>
              <div class="line-num">1</div>
            </div>
            <div class="display-inner">
              <div class="display-mode">STANDARD</div>
              <div class="display-expr" id="displayExpr"></div>
              <div class="display-main" id="displayMain">0</div>
            </div>
          </div>

          <div class="keypad-wrap">
            <div class="keypad-section-label">‚Äî Functions ‚Äî</div>
            <div class="keypad-grid" style="margin-bottom:10px;">
              <button class="key key-fn" onclick="kf('Math.sin(')">sin</button>
              <button class="key key-fn" onclick="kf('Math.cos(')">cos</button>
              <button class="key key-fn" onclick="kf('Math.tan(')">tan</button>
              <button class="key key-fn" onclick="kf('Math.sqrt(')">‚àöx</button>
              <button class="key key-fn" onclick="kf('Math.PI')">œÄ</button>
              <button class="key key-fn" onclick="kf('Math.E')">e</button>
              <button class="key key-fn" onclick="kf('Math.log10(')">log</button>
              <button class="key key-fn" onclick="kf('^')">x‚Åø</button>
            </div>
            <div class="keypad-section-label">‚Äî Numbers ‚Äî</div>
            <div class="keypad-grid">
              <button class="key key-clear" onclick="clearAll()">AC</button>
              <button class="key key-fn" onclick="kf('(')">(</button>
              <button class="key key-fn" onclick="kf(')')">)</button>
              <button class="key key-back" onclick="backspace()">‚å´</button>
              <button class="key key-num" onclick="kn('7')">7</button>
              <button class="key key-num" onclick="kn('8')">8</button>
              <button class="key key-num" onclick="kn('9')">9</button>
              <button class="key key-op" onclick="ko('/')">√∑</button>
              <button class="key key-num" onclick="kn('4')">4</button>
              <button class="key key-num" onclick="kn('5')">5</button>
              <button class="key key-num" onclick="kn('6')">6</button>
              <button class="key key-op" onclick="ko('*')">√ó</button>
              <button class="key key-num" onclick="kn('1')">1</button>
              <button class="key key-num" onclick="kn('2')">2</button>
              <button class="key key-num" onclick="kn('3')">3</button>
              <button class="key key-op" onclick="ko('-')">‚àí</button>
              <button class="key key-num key-zero" onclick="kn('0')">0</button>
              <button class="key key-num" onclick="kn('.')">.</button>
              <button class="key key-op" onclick="ko('+')">+</button>
              <button class="key key-eq" style="grid-column:span 4;" onclick="calculate()">=</button>
            </div>
          </div>

          <div class="calc-bottom">
            <div class="quick-formula-row">
              <span class="qf-chip" onclick="se('Math.PI*')">œÄr¬≤</span>
              <span class="qf-chip" onclick="se('Math.sqrt(')">‚àö</span>
              <span class="qf-chip" onclick="se('Math.E')">euler</span>
              <span class="qf-chip" onclick="se('(1/2)*')">¬Ωbh</span>
            </div>
            <button class="code-mode-btn" onclick="openCodeModal()">‚å® code mode</button>
          </div>
        </div>

        <!-- STICKY NOTES -->
        <div class="right-panel">
          <div class="sticky-note sticky-yellow" style="transform:rotate(-1.5deg);">
            <h4>üí° Did You Know?</h4>
            <div class="fact-body" id="mathFact">Loading...</div>
          </div>
          <div class="sticky-note sticky-blue" style="transform:rotate(1deg);">
            <h4>üìê Key Formulas</h4>
            <div class="formula-rows">
              <div class="formula-row"><span class="formula-eq">A = œÄr¬≤</span><span class="formula-desc">circle area</span></div>
              <div class="formula-row"><span class="formula-eq">c¬≤ = a¬≤+b¬≤</span><span class="formula-desc">Pythagoras</span></div>
              <div class="formula-row"><span class="formula-eq">E = mc¬≤</span><span class="formula-desc">mass-energy</span></div>
              <div class="formula-row"><span class="formula-eq">F = ma</span><span class="formula-desc">Newton 2nd</span></div>
              <div class="formula-row"><span class="formula-eq">V = lwh</span><span class="formula-desc">box volume</span></div>
              <div class="formula-row"><span class="formula-eq">sinŒ∏ = o/h</span><span class="formula-desc">trig ratio</span></div>
            </div>
          </div>
          <div class="sticky-note sticky-pink" style="transform:rotate(-0.8deg);">
            <h4>üïì Recent Calculations</h4>
            <div class="history-rows" id="historyList">
              <div class="history-empty">Nothing yet ‚Äî start calculating!</div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<!-- PASSWORD MODAL -->
<div class="modal-overlay" id="passwordModal">
  <div class="modal-card">
    <div class="modal-header">
      <h2>üîê Code Mode Access</h2>
      <p>Enter your 4-digit access code</p>
    </div>
    <div class="modal-body">
      <div class="pin-label">Enter PIN to unlock ‚Üí</div>
      <div class="pin-row">
        <input class="pin-input" type="password" maxlength="1" id="p0" oninput="pinInput(0)" onkeydown="pinBack(0,event)">
        <input class="pin-input" type="password" maxlength="1" id="p1" oninput="pinInput(1)" onkeydown="pinBack(1,event)">
        <input class="pin-input" type="password" maxlength="1" id="p2" oninput="pinInput(2)" onkeydown="pinBack(2,event)">
        <input class="pin-input" type="password" maxlength="1" id="p3" oninput="pinInput(3)" onkeydown="pinBack(3,event)">
      </div>
      <button class="modal-unlock-btn" onclick="checkPassword()">Unlock ‚Üí</button>
      <button class="modal-cancel-btn" onclick="closeCodeModal()">cancel</button>
    </div>
  </div>
</div>

<!-- CODE MODE -->
<div id="codeModeContainer">
  <iframe id="codeFrame" src="about:blank" sandbox="allow-scripts allow-same-origin allow-popups allow-forms"></iframe>
</div>

<script>
// Date
const now = new Date();
document.getElementById('boardDate').textContent = now.toLocaleDateString('en-US',{weekday:'short',month:'short',day:'numeric',year:'numeric'});

// Calc state
let expr = '';
let history = [];
const dMain = document.getElementById('displayMain');
const dExpr = document.getElementById('displayExpr');

function upd() {
  const t = expr || '0';
  dMain.textContent = t;
  dMain.style.fontSize = t.length > 14 ? '26px' : t.length > 10 ? '34px' : '46px';
}
function pop() { dMain.classList.add('pop'); setTimeout(()=>dMain.classList.remove('pop'),100); }
function kn(n) { if(expr==='0'&&n!=='.')expr=''; expr+=n; upd(); }
function ko(o) { expr+=o; upd(); }
function kf(f) { expr+=f; upd(); }
function backspace() { expr=expr.slice(0,-1); upd(); }
function clearAll() { expr=''; dExpr.textContent=''; upd(); pop(); }
function se(e) { expr=e; upd(); }

function calculate() {
  if(!expr) return;
  try {
    const safe = expr.replace(/\^/g,'**');
    const result = eval(safe);
    const r = parseFloat(parseFloat(result).toFixed(10));
    history.unshift({expr,result:r});
    if(history.length>6) history.pop();
    updateHistory();
    dExpr.textContent = expr+' =';
    expr = String(r);
    upd(); pop();
  } catch(e) {
    dExpr.textContent = expr;
    expr = 'Error';
    upd();
    setTimeout(()=>{expr='';upd();dExpr.textContent='';},1500);
  }
}

function updateHistory() {
  const el = document.getElementById('historyList');
  if(!history.length){ el.innerHTML='<div class="history-empty">Nothing yet ‚Äî start calculating!</div>'; return; }
  el.innerHTML = history.map(h=>`<div class="history-entry" onclick="loadH('${h.result}')"><span>${h.expr.length>16?h.expr.slice(0,16)+'‚Ä¶':h.expr}</span><span class="history-res">${h.result}</span></div>`).join('');
}
function loadH(v) { expr=String(v); upd(); }

// Keyboard
document.addEventListener('keydown',(e)=>{
  if(document.getElementById('passwordModal').classList.contains('active')) return;
  if(document.getElementById('codeModeContainer').classList.contains('active')) return;
  if('0123456789'.includes(e.key)) kn(e.key);
  else if('+-*/'.includes(e.key)) ko(e.key);
  else if(e.key==='.') kn('.');
  else if(e.key==='Enter'||e.key==='=') calculate();
  else if(e.key==='Escape') clearAll();
  else if(e.key==='Backspace') backspace();
});

// Facts
const facts = [
  "<strong>Zero</strong> is the only number that cannot be written in Roman numerals.",
  "<strong>Pi (œÄ)</strong> has been calculated to over 100 trillion decimal places ‚Äî and never repeats.",
  "The sum of 1 to 100 equals <strong>5,050</strong> ‚Äî discovered by Gauss at <strong>age 9!</strong>",
  "A <strong>googol</strong> is 10¬π‚Å∞‚Å∞. It inspired the name <strong>Google</strong>.",
  "<strong>Fibonacci numbers</strong> appear in flower petals, pinecones, and spiral galaxies.",
  "<strong>Euler's identity</strong> e^(iœÄ)+1=0 links the 5 most important numbers in math.",
  "The <strong>Pythagorean theorem</strong> was known 1,000 years before Pythagoras.",
  "There are more sudoku grids possible than <strong>atoms in the observable universe</strong>.",
];
let fi = Math.floor(Math.random()*facts.length);
document.getElementById('mathFact').innerHTML = facts[fi];
setInterval(()=>{ fi=(fi+1)%facts.length; document.getElementById('mathFact').innerHTML=facts[fi]; },9000);

// Modal
function openCodeModal() {
  document.getElementById('passwordModal').classList.add('active');
  ['p0','p1','p2','p3'].forEach(id=>{ const el=document.getElementById(id); el.value=''; el.classList.remove('error'); });
  setTimeout(()=>document.getElementById('p0').focus(),100);
}
function closeCodeModal() { document.getElementById('passwordModal').classList.remove('active'); }
function pinInput(idx) { if(document.getElementById('p'+idx).value.length===1&&idx<3) document.getElementById('p'+(idx+1)).focus(); }
function pinBack(idx,e) {
  if(e.key==='Backspace'&&!document.getElementById('p'+idx).value&&idx>0) document.getElementById('p'+(idx-1)).focus();
  if(e.key==='Enter') checkPassword();
}
function checkPassword() {
  const pin=['p0','p1','p2','p3'].map(id=>document.getElementById(id).value).join('');
  if(pin==='0000') { closeCodeModal(); activateCodeMode(); }
  else {
    ['p0','p1','p2','p3'].forEach(id=>{ document.getElementById(id).classList.add('error'); setTimeout(()=>document.getElementById(id).classList.remove('error'),500); });
    setTimeout(()=>{ ['p0','p1','p2','p3'].forEach(id=>document.getElementById(id).value=''); document.getElementById('p0').focus(); },400);
  }
}

// Code mode
function activateCodeMode() {
  const container = document.getElementById('codeModeContainer');
  const frame = document.getElementById('codeFrame');

  const html = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>College Courses - Standard Library</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
    <style>
        :root{--accent:#4da6ff;}
        body{margin:0;font-family:'Inter',sans-serif;background:#070b14;color:white;height:100vh;overflow:hidden;}
        #startupOverlay{position:fixed;inset:0;background:#0b1220;display:none;align-items:center;justify-content:center;z-index:5000;}
        .startup-box{background:#111a2d;padding:40px;border-radius:20px;display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:20px;border:1px solid rgba(255,255,255,0.05);width:90%;max-width:600px;}
        .startup-btn{padding:20px;border-radius:14px;cursor:pointer;text-align:center;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);transition:.25s;}
        .startup-btn:hover{background:var(--accent);transform:translateY(-3px);color:#000;}
        .count-pill{display:block;font-size:12px;opacity:0.6;margin-top:5px;font-weight:400;}
        .top-bar-container{position:fixed;top:15px;left:0;right:0;display:flex;flex-direction:column;align-items:center;z-index:20;gap:8px;}
        .search-bar{height:50px;padding:0 18px;display:flex;align-items:center;gap:12px;background:rgba(255,255,255,.06);border-radius:16px;border:1px solid rgba(255,255,255,.08);backdrop-filter:blur(12px);}
        .search-bar input{background:none;border:none;outline:none;color:white;font-size:16px;width:220px;}
        #liveCount{font-size:12px;background:var(--accent);color:#000;padding:2px 8px;border-radius:8px;font-weight:800;}
        #sysStatus{font-size:10px;color:var(--accent);text-transform:uppercase;letter-spacing:1.5px;font-weight:bold;height:15px;transition:0.3s;}
        #settingsBtn{position:fixed;top:20px;right:25px;width:45px;height:45px;border-radius:12px;background:rgba(255,255,255,.1);backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.15);display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:30;}
        #settingsOverlay{position:fixed;inset:0;background:rgba(0,0,0,.6);backdrop-filter:blur(8px);display:none;align-items:center;justify-content:center;z-index:2000;}
        .settings-panel{width:340px;padding:25px;border-radius:18px;background:#101726;border:1px solid rgba(255,255,255,.1);display:flex;flex-direction:column;gap:20px;}
        .setting-row{display:flex;justify-content:space-between;align-items:center;}
        select{background:#1a2438;color:white;border:1px solid #333;padding:8px;border-radius:8px;}
        #container{position:fixed;inset:0;display:grid;grid-template-columns:repeat(auto-fill,220px);justify-content:center;gap:18px;padding-top:110px;padding-left:20px;padding-right:20px;padding-bottom:40px;overflow-y:auto;}
        #container::-webkit-scrollbar{display:none;}
        .zone-item{width:220px;height:175px;border-radius:18px;position:relative;overflow:hidden;background:rgba(255,255,255,.06);cursor:pointer;transition:.25s;border:1px solid transparent;}
        .zone-item:hover{transform:translateY(-6px);border-color:var(--accent);}
        .zone-item img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;filter:brightness(0.7);transition:0.3s;}
        .zone-item:hover img{filter:brightness(0.9);}
        .zone-item button{position:absolute;bottom:12px;left:14px;background:none;border:none;color:white;font-size:15px;font-weight:700;text-shadow:0 2px 12px rgba(0,0,0,0.8);pointer-events:none;width:85%;text-align:left;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
        #zoneViewer{position:fixed;inset:0;background:#000;display:none;flex-direction:column;z-index:1000;}
        #zoneFrame{flex:1;border:none;}
        #closeBtn{position:absolute;top:20px;right:25px;width:45px;height:45px;border-radius:12px;background:rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.2);display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:1001;color:white;}
        #loaderBar{position:absolute;top:0;left:0;width:0%;height:4px;background:var(--accent);transition:width 0.2s;}
        #partnerPopup{position:fixed;inset:0;background:rgba(0,0,0,0.65);backdrop-filter:blur(10px);display:flex;align-items:center;justify-content:center;z-index:9999;animation:fadeInBg 0.4s ease;}
        @keyframes fadeInBg{from{opacity:0;}to{opacity:1;}}
        .partner-card{background:linear-gradient(135deg,#0f1c32,#111a2d);border:1px solid rgba(77,166,255,0.35);border-radius:22px;padding:38px 44px;max-width:420px;width:90%;text-align:center;box-shadow:0 0 60px rgba(77,166,255,0.15),0 20px 60px rgba(0,0,0,0.6);animation:slideUp 0.45s cubic-bezier(0.22,1,0.36,1);}
        @keyframes slideUp{from{transform:translateY(30px);opacity:0;}to{transform:translateY(0);opacity:1;}}
        .partner-icon{width:62px;height:62px;border-radius:16px;background:linear-gradient(135deg,var(--accent),#0066cc);display:flex;align-items:center;justify-content:center;margin:0 auto 20px;font-size:26px;}
        .partner-card h2{margin:0 0 10px;font-size:20px;font-weight:700;color:white;}
        .partner-card p{margin:0 0 28px;font-size:15px;color:rgba(255,255,255,0.6);line-height:1.6;}
        .partner-card p span{color:var(--accent);font-weight:700;}
        .partner-close-btn{background:var(--accent);color:#000;border:none;border-radius:12px;padding:12px 32px;font-size:14px;font-weight:800;cursor:pointer;transition:0.2s;}
        .partner-close-btn:hover{opacity:0.85;transform:scale(1.03);}
    </style>
</head>
<body>
<div id="partnerPopup"><div class="partner-card"><h2>A Special Thanks</h2><p>Thanks to my partner <span>Sea Bean</span> for the games!</p><button class="partner-close-btn" onclick="document.getElementById('partnerPopup').style.display='none'">Let's Go &nbsp;\u2192</button></div></div>
<div id="startupOverlay"><div class="startup-box" id="startupBox"></div></div>
<div class="top-bar-container"><div id="sysStatus"></div><div class="search-bar"><i class="fas fa-gamepad" style="opacity:0.5"></i><input id="searchBar" placeholder="Search library..." oninput="filterZones()"><span id="liveCount">0</span></div></div>
<div id="settingsBtn" onclick="toggleSettings()"><i class="fas fa-gear"></i></div>
<div id="settingsOverlay" onclick="toggleSettings(event)"><div class="settings-panel" onclick="event.stopPropagation()"><h3>Settings</h3><div class="setting-row"><span>Accent Color</span><input type="color" id="colorPicker" onchange="changeColor(this.value)"></div><div class="setting-row"><span>Library Source</span><select id="sourceSelect" onchange="toggleSource(this.value)"></select></div></div></div>
<div id="container"></div>
<div id="zoneViewer"><div id="closeBtn" onclick="closeViewer()"><i class="fas fa-times"></i></div><div id="loaderBar"></div><iframe id="zoneFrame"></iframe></div>
<script>
const sources=[{name:"GN Math",type:"json",json:"https://cdn.jsdelivr.net/gh/gn-math/assets@latest/zones.json",cover:"https://cdn.jsdelivr.net/gh/gn-math/covers@main/",html:"https://cdn.jsdelivr.net/gh/gn-math/html@main/"}];
let zones=[],currentSource=0;
async function init(){const sc=localStorage.getItem("accentColor")||"#4da6ff";document.documentElement.style.setProperty('--accent',sc);document.getElementById("colorPicker").value=sc;const sb=document.getElementById("startupBox"),ss=document.getElementById("sourceSelect");sb.innerHTML="";ss.innerHTML="";sources.forEach((s,i)=>{const b=document.createElement("div");b.className="startup-btn";b.innerHTML=\`<b>\${s.name}</b><span class="count-pill">Enter Library</span>\`;b.onclick=()=>chooseStartup(i);sb.appendChild(b);const o=document.createElement("option");o.value=i;o.innerText=s.name;ss.appendChild(o);});document.getElementById("startupOverlay").style.display="flex";}
async function loadSource(){const c=document.getElementById("container");c.innerHTML="<p style='grid-column:1/-1;text-align:center;opacity:0.5;margin-top:50px;'>Syncing Library...</p>";const s=sources[currentSource];try{if(s.type==="json"){const r=await fetch(s.json);zones=await r.json();}displayZones(zones);}catch(e){c.innerHTML="<p style='grid-column:1/-1;text-align:center;color:red;'>Sync Failed.</p>";}}
function displayZones(list){const c=document.getElementById("container");c.innerHTML="";document.getElementById("liveCount").innerText=list.length;const s=sources[currentSource];list.forEach(z=>{const d=document.createElement("div");d.className="zone-item";d.onclick=()=>openZone(z);const img=document.createElement("img");let rc=z.cover||"";img.src=rc.includes("{COVER_URL}")?rc.replace("{COVER_URL}",s.cover):s.cover+rc.replace(/^\//,"");const b=document.createElement("button");b.textContent=z.name;d.append(img,b);c.appendChild(d);});}
function filterZones(){const q=document.getElementById("searchBar").value.toLowerCase();displayZones(zones.filter(z=>z.name&&z.name.toLowerCase().includes(q)));}
function openZone(z){const s=sources[currentSource];let u=z.isDirect?z.url:(z.url.includes("{HTML_URL}")?z.url.replace("{HTML_URL}",s.html):s.html+z.url.replace(/^\//,""));document.getElementById("zoneViewer").style.display="flex";document.getElementById("loaderBar").style.width="40%";fetch(u).then(r=>r.text()).then(h=>{document.getElementById("loaderBar").style.width="100%";const doc=document.getElementById("zoneFrame").contentWindow.document;doc.open();doc.write(h);doc.close();setTimeout(()=>document.getElementById("loaderBar").style.width="0%",400);}).catch(()=>{document.getElementById("zoneFrame").src=u;document.getElementById("loaderBar").style.width="100%";});}
function chooseStartup(i){currentSource=i;localStorage.setItem("sourceIndex",i);document.getElementById("sourceSelect").value=i;document.getElementById("startupOverlay").style.display="none";loadSource();}
function toggleSettings(e){const s=document.getElementById("settingsOverlay");if(e&&e.target!==s)return;s.style.display=s.style.display==="flex"?"none":"flex";}
function changeColor(c){document.documentElement.style.setProperty('--accent',c);localStorage.setItem("accentColor",c);}
function toggleSource(v){currentSource=parseInt(v);localStorage.setItem("sourceIndex",v);loadSource();}
function closeViewer(){document.getElementById("zoneViewer").style.display="none";document.getElementById("zoneFrame").src="about:blank";}
window.addEventListener('DOMContentLoaded',init);
<\/script>
</body>
</html>`;

  const blob = new Blob([html], {type:'text/html'});
  frame.src = URL.createObjectURL(blob);
  container.classList.add('active');
}

</script>
</body>
</html>
